# django-todo Helm Chart

This helm chart is a lightweight way to configure and run [django-todo application](https://github.com/shacker/django-todo)
Django-todo application is installed as a deployment, which pods consists of two containers: backend (django) and nginx.
If `adminUser` is set the chart create appropriate admin user on chart install (or update admin user password if user exists) 

## Requirements

* [Helm](https://helm.sh/) >=3.0.0 (was not tested with Helm 2)
* Kubernetes >=1.14
* PortgresSQL accessible from Kubernetes cluster

## Installing

* Clone [django-todo-demo repository](https://github.com/Torbik/django-todo-demo)
  ```
  git clone https://github.com/Torbik/django-todo-demo.git
  ```
* Install it
  ```
  helm install django-todo helm/charts/django-todo
  ```

## Configuration

| Name                 | Description                                                                                                                                                                          |                                                                                                                           Default                                                                                                                                            |
|:---------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
| `replicas`           | Environment Name                                                                                                                                                                     |                                                                                                                              -                                                                                                                                               |
| `adminUser`          | Credentials of django admin user provisioned during the installation                                                                                                                 |                                                                                                                            `{}`                                                                                                                                              |
| `database.host`      | FQDN/IP of PostgreSQL used for storing django-todo data                                                                                                                              |                                                                                                                         `postgres`                                                                                                                                           |
| `postgres.port`      | PostgreSQL port                                                                                                                                                                      |                                                                                                                           `5432`                                                                                                                                             |
| `postgres.username`  | PostgreSQL username                                                                                                                                                                  |                                                                                                                         `postgres`                                                                                                                                           |
| `postgres.password`  | PostgreSQL password                                                                                                                                                                  |                                                                                                                         `postgres`                                                                                                                                           |
| `postgres.dbName`    | PostgreSQL database name for storing django-todo data                                                                                                                                |                                                                                                                           `todo`                                                                                                                                             |
| `backend.image`      | Docker image parameters are used for django-todo container in the application deployment                                                                                             |                                                                                          `repository: torbik/django-todo`<br>`tag: 0.0.1`<br>`pullPolicy: IfNotPresent`                                                                                                      |
| `nginx.resources`    | Resources for django-todo container in the application deployment                                                                                                                    |                                                                                                                            `{}`                                                                                                                                              |
| `nginx.image`        | Docker image parameters are used for nginx container in the application deployment                                                                                                   |                                                                                             `repository: nginx`<br>`tag: 1.17.8-alpine`<br>`pullPolicy: IfNotPresent`                                                                                                        |
| `nginx.resources`    | Resources for nginx container in the application deployment                                                                                                                          |                                                                                                                            `{}`                                                                                                                                              |
| `updateStrategy`     | `updateStrategy` block for the application deployment determining its [update strategy](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment) |                                                                                                                    `type: RollingUpdate`                                                                                                                                     |
| `service`            | Configurable service to expose django-todo service                                                                                                                                   |                                                                                                               `type: ClusterIP`<br>`port: 8080`                                                                                                                              |
| `livenessProbe`      | Configuration for the [livenessProbe](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/)                                         |                                                                        `initialDelaySeconds: 60`<br>`timeoutSeconds: 2`<br>`periodSeconds: 30`<br>`failureThreshold: 3`<br>`successThreshold: 1`                                                                             |
| `readinessProbe`     | Configuration for the [readinessProbe](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/)                                        |                                                                        `initialDelaySeconds: 10`<br>`timeoutSeconds: 2`<br>`periodSeconds: 10`<br>`failureThreshold: 3`<br>`successThreshold: 1`                                                                             |
| `imagePullSecrets`   | Configuration for imagePullSecrets so that you can use a private registry for your image                                                                                             |                                                                                                                            `[]`                                                                                                                                              |
| `fullnameOverride`   | Overrides the full name of the resources. If not set the name will default to ".Release.Name-.Values.nameOverride" or ".Release.Name-.Chart.Name"                                    |                                                                                                                            `""`                                                                                                                                              |
| `nameOverride`       | Overrides the second part of the resource names. If not set the name will default to ".Release.Name-.Values.nameOverride" or ".Release.Name-.Chart.Name"                             |                                                                                                                            `""`                                                                                                                                              |
| `serviceAccount`     | Specifies whether a service account should be created and the name of the service account to use                                                                                     |                                                                                                                  `create: true`<br>`name: ""`                                                                                                                                |
| `podSecurityContext` | Allows to set the [securityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-pod) for the pod                       |                                                                                                                            `{}`                                                                                                                                              |
| `securityContext`    | Allows to set the [securityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-container) for the container           |                                                                         `capabilities: { "drop": [ "ALL" ] }`<br>`readOnlyRootFilesystem: true`<br>`runAsNonRoot: true`<br>`runAsUser: 1000`                                                                                 |
| `ingress`            | Configurable ingress to expose django-todo service. See [`values.yaml`](values.yaml) for an example                                                                                  |                                                                                                                      `enabled: false`                                                                                                                                        |
| `nodeSelector`       | Configurable nodeSelector so that you can target specific nodes for django-todo instances                                                                                            |                                                                                                                            `{}`                                                                                                                                              |
| `tolerations`        | Configurable [tolerations](https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/)                                                                                  |                                                                                                                            `[]`                                                                                                                                              |
| `affinity`           | Configurable django-todo pods [affinity](https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity)                                              |                                                                                                                            `{}`                                                                                                                                              |
| `maxUnavailable`     | `maxUnavailable` values for django-todo pods [pod disruption budget](https://kubernetes.io/docs/concepts/workloads/pods/disruptions/)                                                |                                                                                                                              1                                                                                                                                               |
| `test`               | Configurable parameters for Helm test pod                                                                                                                                            | `enabled: true`<br>`image.repository: unguiculus/docker-python3-phantomjs-selenium`<br>`image.tag: v1`<br>`image.pullPolicy: IfNotPresent`<br>`securityContext.fsGroup: 1000`<br>`containerSecurityContext.runAsUser: 1000`<br>`containerSecurityContext.runAsNonRoot: true` |

## Test

This chart contains tests that logs in to django-todo application using admin account and ensure that login succeeds.

To run tests for the installed Helm chart release run:
```
helm test <release-name>
```